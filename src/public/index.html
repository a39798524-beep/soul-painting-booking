import React, { useState, useEffect } from 'react';
import { 
  Sparkles, 
  Star, 
  Calendar, 
  User, 
  Phone, 
  MapPin, 
  FastForward, 
  Send, 
  Camera, 
  MessageCircle, 
  AlertCircle,
  Heart,
  Minus
} from 'lucide-react';

const App = () => {
  const [formData, setFormData] = useState({
    name: '',
    phone: '',
    delivery: '7-11',
    isUrgent: false,
    birthDate: '',
    photo: null,
    selectedDate: ''
  });

  const [isSubmitted, setIsSubmitted] = useState(false);
  const [stars, setStars] = useState([]);

  // æ¨¡æ“¬å·²è¢«é ç´„çš„æ—¥æœŸ (YYYY-MM-DD)
  const bookedDates = ['2025-03-15', '2025-03-22', '2025-04-05'];

  useEffect(() => {
    // ç”Ÿæˆæ˜Ÿå…‰è£é£¾
    const newStars = Array.from({ length: 40 }).map((_, i) => ({
      id: i,
      left: `${Math.random() * 100}%`,
      top: `${Math.random() * 100}%`,
      size: Math.random() * 4 + 1,
      duration: Math.random() * 4 + 2,
      delay: Math.random() * 5
    }));
    setStars(newStars);
  }, []);

  const getShippingFee = () => {
    if (formData.delivery === '7-11' || formData.delivery === 'FamilyMart') return 60;
    if (formData.delivery === 'Home') return 140;
    return 0;
  };

  const calculateTotal = () => {
    let total = 0;
    total += getShippingFee();
    if (formData.isUrgent) total += 1000;
    return total;
  };

  const handleFileChange = (e) => {
    if (e.target.files && e.target.files[0]) {
      setFormData(prev => ({ ...prev, photo: e.target.files[0].name }));
    }
  };

  const handleLineRedirect = () => {
    const urgentText = formData.isUrgent ? 'ã€æ€¥ä»¶ ğŸ”¥ã€‘' : 'ã€ä¸€èˆ¬ä»¶ã€‘';
    const message = `ä½ å¥½ Chloeï¼æˆ‘å·²å®Œæˆé ç´„è³‡æ–™å¡«å¯«ï¼Œæº–å‚™é€²è¡ŒåŒ¯æ¬¾ï¼š
${urgentText}
å§“åï¼š${formData.name}
é›»è©±ï¼š${formData.phone}
é ç´„æ—¥æœŸï¼š${formData.selectedDate}
å‡ºç”Ÿæœˆæ—¥ï¼š${formData.birthDate}
å–ä»¶æ–¹å¼ï¼š${formData.delivery}
é™„åŠ è²»ç”¨å°è¨ˆï¼š$${calculateTotal()}
------------------
æˆ‘å·²æº–å‚™å¥½å‰å¾€ LINE å®ŒæˆåŒ¯æ¬¾é ç´„æµç¨‹ã€‚`;
    
    const lineUrl = `https://line.me/R/ti/p/@445covnm?text=${encodeURIComponent(message)}`;
    window.open(lineUrl, '_blank');
  };

  const getDateStatus = (dateStr) => {
    if (!dateStr) return null;
    const date = new Date(dateStr);
    const year = date.getFullYear();
    const month = date.getMonth(); 
    
    // 2025å¹´ 3æœˆ(month=2) ä»¥å‰é¡¯ç¤ºé ç´„å·²æ»¿
    if (year === 2025 && month < 2) return "full";
    if (bookedDates.includes(dateStr)) return "booked";
    return "available";
  };

  return (
    <div className="min-h-screen bg-[#FAF9F6] text-[#5D544F] font-sans relative overflow-hidden pb-24 selection:bg-[#E8DED3]">
      
      {/* èƒŒæ™¯è£é£¾ */}
      <div className="absolute inset-0 pointer-events-none">
        {stars.map((star) => (
          <div
            key={star.id}
            className="absolute rounded-full bg-[#D4AF37] animate-pulse"
            style={{
              left: star.left,
              top: star.top,
              width: `${star.size}px`,
              height: `${star.size}px`,
              opacity: 0.25,
              animationDuration: `${star.duration}s`,
            }}
          />
        ))}
        <svg className="absolute inset-0 w-full h-full opacity-[0.06]" xmlns="http://www.w3.org/2000/svg">
          <line x1="0" y1="30%" x2="100%" y2="70%" stroke="#C9A98E" strokeWidth="1.5" />
          <line x1="100%" y1="20%" x2="0%" y2="80%" stroke="#C9A98E" strokeWidth="1.5" />
          <circle cx="85%" cy="15%" r="180" fill="none" stroke="#C9A98E" strokeWidth="0.8" />
        </svg>
      </div>

      <div className="relative z-10 max-w-2xl mx-auto px-6 pt-20">
        {/* Header */}
        <div className="text-center mb-14 relative">
          <div className="inline-block mb-4 p-3 rounded-full bg-white/60 border border-[#E8DED3] backdrop-blur-sm relative">
             <div className="absolute -top-1 -right-1"><Star className="w-4 h-4 text-[#C9A98E] animate-spin-slow" /></div>
            <Sparkles className="w-8 h-8 text-[#C9A98E]" />
          </div>
          <h1 className="text-4xl font-light tracking-[0.4em] text-[#5D544F] mb-3">
            éˆé­‚ç•«å®¶ Chloe
          </h1>
          <div className="flex items-center justify-center gap-3">
            <Minus className="w-5 h-5 text-[#C9A98E]/40" />
            <p className="text-[#A89F94] tracking-[0.2em] text-sm font-light uppercase italic">Pure Soul Art</p>
            <Minus className="w-5 h-5 text-[#C9A98E]/40" />
          </div>
        </div>

        {/* æµ·å¤–å®¢æˆ¶æç¤º */}
        <div className="mb-10 p-5 rounded-[1.5rem] bg-white/50 border-l-8 border-[#C9A98E] flex items-start gap-4 backdrop-blur-sm shadow-sm">
          <AlertCircle className="w-6 h-6 text-[#C9A98E] shrink-0 mt-0.5" />
          <div>
            <p className="text-base text-[#7D746D] font-medium">
              æµ·å¤–å®¢æˆ¶é ç´„ï¼Œè«‹ç›´æ¥ç§è¨Šå®˜æ–¹ LINE å¡«å¯«é ç´„è³‡æ–™ã€‚
            </p>
            <a href="https://line.me/R/ti/p/@445covnm" target="_blank" rel="noreferrer" className="text-sm text-[#C9A98E] font-bold underline mt-1.5 inline-block">
              é»æ“Šå‰å¾€ LINE @445covnm
            </a>
          </div>
        </div>

        {/* Form Container */}
        <div className="bg-white/95 backdrop-blur-lg border border-[#F0EBE3] rounded-[2.5rem] p-10 shadow-[0_20px_60px_rgba(201,169,142,0.2)] relative">
          
          <form className="space-y-8" onSubmit={(e) => { e.preventDefault(); setIsSubmitted(true); }}>
            
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div className="space-y-3">
                <label className="flex items-center gap-2 text-sm font-semibold text-[#A89F94] px-1">
                  <User className="w-4 h-4" /> Name å§“å
                </label>
                <input 
                  type="text" 
                  required
                  className="w-full bg-[#FAF9F6] border border-[#F0EBE3] rounded-2xl px-5 py-4 text-lg focus:outline-none focus:ring-2 focus:ring-[#C9A98E]/20 transition-all text-[#5D544F] placeholder:text-[#D1CDC7]"
                  placeholder="è«‹è¼¸å…¥å§“å"
                  value={formData.name}
                  onChange={(e) => setFormData(prev => ({...prev, name: e.target.value}))}
                />
              </div>
              <div className="space-y-3">
                <label className="flex items-center gap-2 text-sm font-semibold text-[#A89F94] px-1">
                  <Phone className="w-4 h-4" /> Phone é›»è©±
                </label>
                <input 
                  type="tel" 
                  required
                  className="w-full bg-[#FAF9F6] border border-[#F0EBE3] rounded-2xl px-5 py-4 text-lg focus:outline-none focus:ring-2 focus:ring-[#C9A98E]/20 transition-all text-[#5D544F]"
                  placeholder="è¯çµ¡é›»è©±"
                  value={formData.phone}
                  onChange={(e) => setFormData(prev => ({...prev, phone: e.target.value}))}
                />
              </div>
            </div>

            <div className="space-y-3">
              <label className="flex items-center gap-2 text-sm font-semibold text-[#A89F94] px-1">
                <Heart className="w-4 h-4" /> Birthday å‡ºç”Ÿæœˆæ—¥
              </label>
              <input 
                type="text" 
                required
                className="w-full bg-[#FAF9F6] border border-[#F0EBE3] rounded-2xl px-5 py-4 text-lg focus:outline-none focus:ring-2 focus:ring-[#C9A98E]/20 transition-all text-[#5D544F]"
                placeholder="ä¾‹å¦‚ï¼š08æœˆ19æ—¥"
                value={formData.birthDate}
                onChange={(e) => setFormData(prev => ({...prev, birthDate: e.target.value}))}
              />
            </div>

            <div className="space-y-3">
              <label className="flex items-center gap-2 text-sm font-semibold text-[#A89F94] px-1">
                <Calendar className="w-4 h-4" /> Date é ç´„ç¹ªè£½æ—¥æœŸ
              </label>
              <input 
                type="date" 
                required
                min="2025-01-01"
                className="w-full bg-[#FAF9F6] border border-[#F0EBE3] rounded-2xl px-5 py-4 text-lg focus:outline-none focus:ring-2 focus:ring-[#C9A98E]/20 transition-all text-[#5D544F] cursor-pointer"
                value={formData.selectedDate}
                onChange={(e) => {
                  const val = e.target.value;
                  const status = getDateStatus(val);
                  if (status === "full") {
                    alert("2025å¹´3æœˆå‰é ç´„å·²æ»¿ï¼Œè«‹é¸æ“‡3æœˆå¾Œçš„æ—¥æœŸã€‚");
                    return;
                  }
                  if (status === "booked") {
                    alert("æ­¤æ—¥æœŸå·²è¢«ä»–äººé ç´„ï¼Œè«‹é¸æ“‡å…¶ä»–æ—¥æœŸã€‚");
                    return;
                  }
                  setFormData(prev => ({...prev, selectedDate: val}));
                }}
              />
              <p className="text-xs text-[#C9A98E] mt-2 font-medium italic">
                ï¼Š2025å¹´3æœˆå‰é ç´„å·²æ»¿ï¼Œæ˜å¹´èµ·æ¢å¾©å…¨å¹´é ç´„ã€‚
              </p>
            </div>

            <div className="space-y-4">
              <label className="flex items-center gap-2 text-sm font-semibold text-[#A89F94] px-1">
                <MapPin className="w-4 h-4" /> Delivery å–ä»¶æ–¹å¼
              </label>
              <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
                {[
                  {id: '7-11', label: '7-11 (+60)', icon: 'ğŸª'},
                  {id: 'FamilyMart', label: 'å…¨å®¶ (+60)', icon: 'ğŸª'},
                  {id: 'Home', label: 'å®…é… (+140)', icon: 'ğŸ '}
                ].map((option) => (
                  <button
                    key={option.id}
                    type="button"
                    onClick={() => setFormData(prev => ({...prev, delivery: option.id}))}
                    className={`p-4 rounded-2xl border text-sm flex flex-row sm:flex-col items-center justify-center gap-2 transition-all ${
                      formData.delivery === option.id 
                      ? 'bg-[#C9A98E] border-[#C9A98E] text-white shadow-lg scale-[1.02]' 
                      : 'bg-[#FAF9F6] border-[#F0EBE3] text-[#7D746D] hover:bg-white'
                    }`}
                  >
                    <span className="text-xl">{option.icon}</span>
                    <span cla
